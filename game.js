(()=>{"use strict";const e=document.getElementById("screen"),t=e.getContext("2d"),s=document.getElementById("background");e.width=window.innerWidth-10,e.height=window.innerHeight-10;try{Neutralino.init()}catch(e){console.log("Not running in desktop")}function i(e){let t,s,i,o=~~(6*e),a=6*e-o,h=1-a;switch(o%6){case 0:t=1,s=a,i=0;break;case 1:t=h,s=1,i=0;break;case 2:t=0,s=1,i=a;break;case 3:t=0,s=h,i=1;break;case 4:t=a,s=0,i=1;break;case 5:t=1,s=0,i=h}return"#"+("00"+(~~(255*t)).toString(16)).slice(-2)+("00"+(~~(255*s)).toString(16)).slice(-2)+("00"+(~~(255*i)).toString(16)).slice(-2)}function o(e,t=0){return e===t?e:(e-=t,Math.round(Math.random()*e+t))}function a(e){return Math.random()<=e}function h(e,t){return Math.sqrt(Math.abs(e)*Math.abs(e)+Math.abs(t)*Math.abs(t))}function m(){t.clearRect(0,0,e.width,e.height)}function r(e,s=!1,i=e.imgId){const o=document.getElementById(i);t.beginPath(),t.save(),s&&(t.shadowOffX=10,t.shadowOffY=10,t.shadowBlur=20,t.shadowColor=e.color),t.translate(e.x,e.y),t.rotate(e.angle*Math.PI/180),t.drawImage(o,-e.radius-1,-e.radius-1,2*e.radius+2,2*e.radius+2),t.restore()}function l(){t.beginPath(),t.drawImage(s,0,0,e.width,e.height)}const n={game:{timePerSpawn:15e3,timePerLevel:6e4,timePerSurvivalScore:5e3,survivalAsteroidBonus:.2,survivalLevelBonus:1,itemDropMultiplierWhenExploreToChild:.2,itemDropMultiplierUseSpecialAmmo:.05,multiDrop:!1},asteroid:{spin:.3,damagePerRadius:.25,childrenSizeRatio:.6,minimalSizeCanSplit:28,minNumberOfChild:2,maxNumberOfChild:2,minSize:60,maxSize:80,minSpeed:0,maxSpeed:5},ship:{health:100,speed:5,spin:.3,size:20},ammo:{damage:8,destroyAsteroidRate:.6,speed:10,size:25},items:{ammos:{ammo1:"Blue",ammo2:"Red",ammo3:"Bomb"},item0:{name:"Blue Ammo",amount:3,rate:.2},item1:{name:"Burger",heal:20,rate:.2},item2:{name:"Red Ammo",amount:1,rate:.05},item3:{name:"Antimatter Bomb",amount:1,rate:.03},item4:{name:"Gold",rate:.3,score:30}}};class d{constructor(t,s,a,h,m,r,l,d){this.imgId=l||function(e){let t="rock";return t+=o(7,0)+"",t}(),this.spinSpeed=0===d?0:d||n.asteroid.spin,this.isExist=!0,this.x=t||e.width/2,this.y=s||e.height/2,this.color=h||i(Math.random()),this.radius=a||o(n.asteroid.maxSize,n.asteroid.minSize),this.xSpeed=m||o(n.asteroid.maxSpeed,n.asteroid.minSpeed),this.ySpeed=r||o(n.asteroid.maxSpeed,n.asteroid.minSpeed),this.angle=0,this.damage=this.radius*n.asteroid.damagePerRadius}increaseAngle(e){this.angle=this.angle+e,this.angle>=360&&(this.angle=0)}makeAMove(){this.x+=this.xSpeed,this.y+=this.ySpeed,this.spinSpeed&&this.increaseAngle(h(this.xSpeed,this.ySpeed)*this.spinSpeed)}relocate(e,t,s){const i=this.radius+s,o=h(this.x-e,this.y-t);i>o&&(this.x=(this.x-e)*(i/o)+e,this.y=(this.y-t)*(i/o)+t)}toEdge(){this.x<=this.radius?(this.x=this.radius,this.xSpeed*=-1):this.x>=e.width-this.radius?(this.x=e.width-this.radius,this.xSpeed*=-1):this.y<=this.radius?(this.y=this.radius,this.ySpeed*=-1):this.y>=e.height-this.radius&&(this.y=e.height-this.radius,this.ySpeed*=-1)}toBall(e){for(const t of e){const e=t.radius+this.radius,s=h(t.x-this.x,t.y-this.y);if(0!==s&&(e>s&&this.relocate(t.x,t.y,t.radius),e>=s)){const s=((this.radius-t.radius)*this.xSpeed+2*t.radius*t.xSpeed)/e,i=((this.radius-t.radius)*this.ySpeed+2*t.radius*t.ySpeed)/e,o=((t.radius-this.radius)*t.xSpeed+2*this.radius*this.xSpeed)/e,a=((t.radius-this.radius)*t.ySpeed+2*this.radius*this.ySpeed)/e;this.xSpeed=s,this.ySpeed=i,t.xSpeed=o,t.ySpeed=a}}}toObj(e){const t=this.radius+e.radius,s=h(this.x-e.x,this.y-e.y);if(0!==s&&(s<t&&this.relocate(e.x,e.y,e.radius),s<=t))return this.xSpeed*=-1,this.ySpeed*=-1,!0}toArrOfObj(e){for(let t=0;t<e.length;t++)if(e[t].radius+this.radius>=h(e[t].x-this.x,e[t].y-this.y))return t;return-1}remove(e){this.isExist=!1;for(let t=0;t<e.length;t++)e[t].isExist||e.splice(t,1)}explore(e){this.remove(e);const t=o(n.asteroid.maxNumberOfChild,n.asteroid.minNumberOfChild);if(t&&this.canExploreToSmaller())for(let s=0;s<t;s++)e.push(new d(this.x,this.y,this.radius*n.asteroid.childrenSizeRatio,this.color,void 0,void 0,this.imgId))}canExploreToSmaller(){return this.radius>n.asteroid.minimalSizeCanSplit}spawn(e,t=1){for(let s=0;s<t;s++)e.push(new d(this.x,this.y,void 0,this.color))}makeExplosive(e,t){o(1,0)?(e.push(new p(this.x,this.y,2*this.radius,"explosive0",t)),e.push(new p(this.x,this.y,1.2*this.radius,void 0,t))):o(1,0)?e.push(new p(this.x,this.y,2*this.radius,void 0,t)):(e.push(new p(this.x,this.y,3.5*this.radius,"explosive4",t)),e.push(new p(this.x,this.y,1*this.radius,void 0,t)))}}class p extends d{constructor(e,t,s,i,a){super(e,t,s,"yellow",.2,.2),this.imgId=i||function(e){let t="explosive";return t+=o(4,0)+"",t}(),this.count=50*a||50}drawExplosive(e){this.count>0?(r(this,!1),this.count-=1):this.remove(e)}}class u extends d{constructor(e,t,s,i,o,a){super(e,t,a||n.ammo.size,"green",s,i),this.imgId=o||"ammo0",this.damage=n.ammo.damage}}class c extends d{constructor(e,t,s,i=25){super(e,t,i,"blue",.5,.5),this.imgId=s||"item0"}doFunc(e){switch(this.imgId){case"item0":for(let t=0;t<n.items.item0.amount;t++)e.totalAmmo.push(new u(e.x,e.y,1,1,"ammo1",30));break;case"item1":e.health+=n.items.item1.heal;break;case"item2":for(let t=0;t<n.items.item2.amount;t++)e.totalAmmo.push(new u(e.x,e.y,1,1,"ammo2",30));break;case"item3":for(let t=0;t<n.items.item3.amount;t++)e.totalAmmo.push(new u(e.x,e.y,1,1,"ammo3",30))}}}class x extends d{constructor(e,t,s,i,o,a){super(e,t,n.ship.size,o,.2,.2),this.color=o||"white",this.imgId=a||"ship",this.speed=s||n.ship.speed,this.health=i||n.ship.health,this.spinSpeed=n.ship.spin,this.totalAmmo=[]}shoot(e,t=this.angle,s,i){const o=n.ammo.speed*Math.cos((t-90)*Math.PI/180),a=n.ammo.speed*Math.sin((t-90)*Math.PI/180),h=this.x+(this.radius+n.ammo.size+1)*Math.cos((t-90)*Math.PI/180),m=this.y+(this.radius+n.ammo.size+1)*Math.sin((t-90)*Math.PI/180);e.push(new u(h,m,o,a,s,i))}moveLeft(){this.xSpeed>=-this.speed&&(this.xSpeed=-1*this.speed,this.ySpeed=0)}moveRight(){this.xSpeed<=this.speed&&(this.xSpeed=this.speed,this.ySpeed=0)}moveUp(){this.ySpeed>=-this.speed&&(this.ySpeed=-1*this.speed,this.xSpeed=0)}moveDown(){this.ySpeed<=this.speed&&(this.ySpeed=this.speed,this.xSpeed=0)}}class g extends d{constructor(){super(void 0,void 0,100,void 0,0,0,"planet")}}const S=new class{constructor(){this.score=0,this.items=[],this.ship=new x(200,800),this.spawner=new g,this.balls=[],this.ammos=[],this.spammos=[],this.explosive=[]}itemState(){for(const e of this.items)e.toBall(this.items),e.toObj(this.spawner),e.toEdge(),e.toObj(this.ship)&&("item4"===e.imgId&&(this.score+=n.items.item4.score),e.doFunc(this.ship),e.remove(this.items)),e.makeAMove(),r(e)}specialAmmoState(){for(const e of this.spammos){if(e.toObj(this.ship)&&"ammo1"===e.imgId&&(this.ship.health-=e.damage),"ammo3"===e.imgId){for(const e of this.balls)e.makeExplosive(this.explosive);for(const e of this.ammos)this.explosive.push(new p(e.x,e.y,e.radius/2,"explosive5",.3));this.balls=[],this.ammos=[],this.spammos=this.spammos.filter((t=>t!==e))}"ammo2"===e.imgId&&(e.toEdge(),e.toObj(this.spawner),e.toObj(this.ship)&&(this.ship.health+=3)),e.makeAMove(),r(e)}}ammoState(){for(const e of this.ammos){if(e.toEdge(),e.toObj(this.spawner),e.toObj(this.ship)&&(this.ship.health-=e.damage),e.toArrOfObj(this.balls)>=0){const t=this.balls[e.toArrOfObj(this.balls)];a(n.ammo.destroyAsteroidRate)?t.canExploreToSmaller()?(t.explore(this.balls),t.makeExplosive(this.explosive),e.remove(this.ammos),this.score+=5,this.spawnItemFrom(t,n.game.itemDropMultiplierWhenExploreToChild)):this.spawnItemFrom(t):e.toBall(this.balls)}e.makeAMove()}}ballState(){for(const e of this.balls)e.toEdge(),e.toObj(this.spawner),e.toObj(this.ship)&&(e.explore(this.balls),this.ship.health-=e.damage,this.score-=10,e.makeExplosive(this.explosive)),e.toArrOfObj(this.ammos)>=0&&(a(n.ammo.destroyAsteroidRate)?(this.ammos[e.toArrOfObj(this.ammos)].remove(this.ammos),e.makeExplosive(this.explosive),e.canExploreToSmaller()?(e.explore(this.balls),this.score+=5,this.spawnItemFrom(e,n.game.itemDropMultiplierWhenExploreToChild)):this.spawnItemFrom(e)):e.toBall(this.ammos)),e.toArrOfObj(this.spammos)>=0&&(a(n.ammo.destroyAsteroidRate)?e.remove(this.balls):e.canExploreToSmaller()?e.explore(this.balls):e.remove(this.balls),this.spawnItemFrom(e,n.game.itemDropMultiplierUseSpecialAmmo),e.makeExplosive(this.explosive),this.score+=5),e.toBall(this.balls),e.makeAMove()}spawnItemFrom(e,t=1){e.remove(this.balls),e.makeExplosive(this.explosive,.3),this.score+=5,a(n.items.item0.rate*t)&&(this.items.push(new c(e.x,e.y,"item0")),!n.game.multiDrop)||a(n.items.item1.rate*t)&&(this.items.push(new c(e.x,e.y,"item1")),!n.game.multiDrop)||a(n.items.item2.rate*t)&&(this.items.push(new c(e.x,e.y,"item2")),!n.game.multiDrop)||a(n.items.item3.rate*t)&&(this.items.push(new c(e.x,e.y,"item3")),!n.game.multiDrop)||a(n.items.item4.rate*t)&&this.items.push(new c(e.x,e.y,"item4"))}drawBall(){for(const e of this.balls)r(e)}drawAmmo(){for(const e of this.ammos)r(e,!0)}shipState(){this.ship.health<=0&&(m(),l(),setTimeout((async()=>{await async function(e,t){try{return"YES"===await window.Neutralino.os.showMessageBox("You lose",t,"YES_NO")}catch(e){return confirm(t)}}(0,"Play again?")&&window.location.reload()}),1e3)),this.ship.toObj(this.spawner),this.ship.toEdge(),this.ship.makeAMove()}displayScore(e,s,i=""){t.font="25px Verdana",t.fillStyle="white",t.fillText(i,e,s-30),t.fillText("Health "+Math.floor(this.ship.health),e,s),t.fillText("Items: "+this.ship.totalAmmo.length,e,s+30),t.fillText("Score "+this.score,e,s+110);const o=this.ship.totalAmmo.length?this.ship.totalAmmo[this.ship.totalAmmo.length-1].imgId:"",a=n.items.ammos[o]||"None";t.fillText("Ammo: "+a,e,s+60)}drawExplosion(){for(const e of this.explosive)e.drawExplosive(this.explosive)}combineState(){this.specialAmmoState(),this.ammoState(),this.ballState(),this.shipState(),this.itemState()}};let w=0;!function(e){let t="";for(let e=0;e<8;e++)t+='<img alt="rock" src="img/rock/rock'+e+'.png" id="rock'+e+'" style="display: none">';document.getElementById("img-dir").innerHTML+=t}(),function(e){let t="";for(let e=0;e<4;e++)t+='<img alt="ammo" src="img/ammo/ammo'+e+'.png" id="ammo'+e+'" style="display: none">';document.getElementById("img-dir").innerHTML+=t}(),function(e){let t="";for(let e=0;e<5;e++)t+='<img alt="object" src="img/item/item'+e+'.png" id="item'+e+'" style="display: none">';document.getElementById("img-dir").innerHTML+=t}(),function(e){let t="";for(let e=0;e<6;e++)t+='<img alt="explosive" src="img/explosive/explosive'+e+'.png" id="explosive'+e+'" style="display: none">';document.getElementById("img-dir").innerHTML+=t}(),function e(){S.score+=w*n.game.survivalLevelBonus+Math.floor((S.balls.length+S.ammos.length)*n.game.survivalAsteroidBonus),setTimeout(e,n.game.timePerSurvivalScore)}(),function e(){m(),l(),S.combineState(),S.drawExplosion(),S.drawAmmo(),S.drawBall(),r(S.spawner,!0),r(S.ship,!0),S.displayScore(15,60,"stage: "+w),S.ship.health>0?setTimeout(e,20):r(S.ship,!1,"explosive1")}(),function e(){w++,setTimeout(e,n.game.timePerLevel)}(),function e(){S.spawner.spawn(S.balls,w),S.spawner.color=i(Math.random()),setTimeout(e,n.game.timePerSpawn)}(),window.addEventListener("keydown",(e=>{switch(e.key){case"ArrowRight":S.ship.moveRight();break;case"ArrowLeft":S.ship.moveLeft();break;case"ArrowUp":S.ship.moveUp();break;case"ArrowDown":S.ship.moveDown();break;case"a":if(S.ship.totalAmmo.length>0){const e=S.ship.totalAmmo.pop();S.ship.shoot(S.spammos,S.ship.angle,e.imgId,10)}break;case"s":S.ship.shoot(S.ammos,S.ship.angle,"ammo0")}}))})();