(()=>{"use strict";const e=document.getElementById("screen"),t=e.getContext("2d"),s=window.gameConfig||{game:{timePerSpawn:15e3,timePerLevel:6e4,timePerSurvivalScore:5e3,survivalAsteroidBonus:.2,survivalLevelBonus:1,itemDropMultiplierWhenExploreToChild:.2,itemDropMultiplierUseSpecialAmmo:.05,multiDrop:!1},asteroid:{spin:.3,damagePerRadius:.25,childrenSizeRatio:.6,minimalSizeCanSplit:28,minNumberOfChild:2,maxNumberOfChild:2,minSize:60,maxSize:80,minSpeed:0,maxSpeed:5},ship:{health:100,speed:5,spin:.3,size:20},ammo:{damage:8,destroyAsteroidRate:.6,speed:10,size:25},items:{ammos:{ammo1:"Blue",ammo2:"Red",ammo3:"Bomb"},item0:{name:"Blue Ammo",amount:3,rate:.2},item1:{name:"Burger",heal:20,rate:.2},item2:{name:"Red Ammo",amount:1,rate:.05},item3:{name:"Antimatter Bomb",amount:1,rate:.03},item4:{name:"Gold",rate:.3,score:30}}},i=document.getElementById("background"),o=document.getElementById("img-dir");function a(e){let t,s,i,o=~~(6*e),a=6*e-o,h=1-a;switch(o%6){case 0:t=1,s=a,i=0;break;case 1:t=h,s=1,i=0;break;case 2:t=0,s=1,i=a;break;case 3:t=0,s=h,i=1;break;case 4:t=a,s=0,i=1;break;case 5:t=1,s=0,i=h}return"#"+("00"+(~~(255*t)).toString(16)).slice(-2)+("00"+(~~(255*s)).toString(16)).slice(-2)+("00"+(~~(255*i)).toString(16)).slice(-2)}function h(e,t=0){return e===t?e:(e-=t,Math.round(Math.random()*e+t))}function m(e){return Math.random()<=e}function r(e,t){return Math.sqrt(Math.abs(e)*Math.abs(e)+Math.abs(t)*Math.abs(t))}function l(){t.clearRect(0,0,e.width,e.height)}function n(e,s=!1,i=e.imgId){const o=document.getElementById(i);t.beginPath(),t.save(),s&&(t.shadowOffX=10,t.shadowOffY=10,t.shadowBlur=20,t.shadowColor=e.color),t.translate(e.x,e.y),t.rotate(e.angle*Math.PI/180),t.drawImage(o,-e.radius-1,-e.radius-1,2*e.radius+2,2*e.radius+2),t.restore()}function d(){t.beginPath(),t.drawImage(i,0,0,e.width,e.height)}e.width=window.innerWidth-10,e.height=window.innerHeight-10;class p{constructor(t,i,o,m,r,l,n,d){this.imgId=n||function(e){let t="rock";return t+=h(7,0)+"",t}(),this.spinSpeed=0===d?0:d||s.asteroid.spin,this.isExist=!0,this.x=t||e.width/2,this.y=i||e.height/2,this.color=m||a(Math.random()),this.radius=o||h(s.asteroid.maxSize,s.asteroid.minSize),this.xSpeed=r||h(s.asteroid.maxSpeed,s.asteroid.minSpeed),this.ySpeed=l||h(s.asteroid.maxSpeed,s.asteroid.minSpeed),this.angle=0,this.damage=this.radius*s.asteroid.damagePerRadius}increaseAngle(e){this.angle=this.angle+e,this.angle>=360&&(this.angle=0)}makeAMove(){this.x+=this.xSpeed,this.y+=this.ySpeed,this.spinSpeed&&this.increaseAngle(r(this.xSpeed,this.ySpeed)*this.spinSpeed)}relocate(e,t,s){const i=this.radius+s,o=r(this.x-e,this.y-t);i>o&&(this.x=(this.x-e)*(i/o)+e,this.y=(this.y-t)*(i/o)+t)}toEdge(){this.x<=this.radius?(this.x=this.radius,this.xSpeed*=-1):this.x>=e.width-this.radius?(this.x=e.width-this.radius,this.xSpeed*=-1):this.y<=this.radius?(this.y=this.radius,this.ySpeed*=-1):this.y>=e.height-this.radius&&(this.y=e.height-this.radius,this.ySpeed*=-1)}toBall(e){for(const t of e){const e=t.radius+this.radius,s=r(t.x-this.x,t.y-this.y);if(0!==s&&(e>s&&this.relocate(t.x,t.y,t.radius),e>=s)){const s=((this.radius-t.radius)*this.xSpeed+2*t.radius*t.xSpeed)/e,i=((this.radius-t.radius)*this.ySpeed+2*t.radius*t.ySpeed)/e,o=((t.radius-this.radius)*t.xSpeed+2*this.radius*this.xSpeed)/e,a=((t.radius-this.radius)*t.ySpeed+2*this.radius*this.ySpeed)/e;this.xSpeed=s,this.ySpeed=i,t.xSpeed=o,t.ySpeed=a}}}toObj(e){const t=this.radius+e.radius,s=r(this.x-e.x,this.y-e.y);if(0!==s&&(s<t&&this.relocate(e.x,e.y,e.radius),s<=t))return this.xSpeed*=-1,this.ySpeed*=-1,!0}toArrOfObj(e){for(let t=0;t<e.length;t++)if(e[t].radius+this.radius>=r(e[t].x-this.x,e[t].y-this.y))return t;return-1}remove(e){this.isExist=!1;for(let t=0;t<e.length;t++)e[t].isExist||e.splice(t,1)}explore(e){this.remove(e);const t=h(s.asteroid.maxNumberOfChild,s.asteroid.minNumberOfChild);if(t&&this.canExploreToSmaller())for(let i=0;i<t;i++)e.push(new p(this.x,this.y,this.radius*s.asteroid.childrenSizeRatio,this.color,void 0,void 0,this.imgId))}canExploreToSmaller(){return this.radius>s.asteroid.minimalSizeCanSplit}spawn(e,t=1){for(let s=0;s<t;s++)e.push(new p(this.x,this.y,void 0,this.color))}makeExplosive(e,t){h(1,0)?(e.push(new u(this.x,this.y,2*this.radius,"explosive0",t)),e.push(new u(this.x,this.y,1.2*this.radius,void 0,t))):h(1,0)?e.push(new u(this.x,this.y,2*this.radius,void 0,t)):(e.push(new u(this.x,this.y,3.5*this.radius,"explosive4",t)),e.push(new u(this.x,this.y,1*this.radius,void 0,t)))}}class u extends p{constructor(e,t,s,i,o){super(e,t,s,"yellow",.2,.2),this.imgId=i||function(e){let t="explosive";return t+=h(4,0)+"",t}(),this.count=50*o||50}drawExplosive(e){this.count>0?(n(this,!1),this.count-=1):this.remove(e)}}class c extends p{constructor(e,t,i,o,a,h){super(e,t,h||s.ammo.size,"green",i,o),this.imgId=a||"ammo0",this.damage=s.ammo.damage}}class x extends p{constructor(e,t,s,i=25){super(e,t,i,"blue",.5,.5),this.imgId=s||"item0"}doFunc(e){switch(this.imgId){case"item0":for(let t=0;t<s.items.item0.amount;t++)e.totalAmmo.push(new c(e.x,e.y,1,1,"ammo1",30));break;case"item1":e.health+=s.items.item1.heal;break;case"item2":for(let t=0;t<s.items.item2.amount;t++)e.totalAmmo.push(new c(e.x,e.y,1,1,"ammo2",30));break;case"item3":for(let t=0;t<s.items.item3.amount;t++)e.totalAmmo.push(new c(e.x,e.y,1,1,"ammo3",30))}}}class g extends p{constructor(e,t,i,o,a,h){super(e,t,s.ship.size,a,.2,.2),this.color=a||"white",this.imgId=h||"ship",this.speed=i||s.ship.speed,this.health=o||s.ship.health,this.spinSpeed=s.ship.spin,this.totalAmmo=[]}shoot(e,t=this.angle,i,o){const a=s.ammo.speed*Math.cos((t-90)*Math.PI/180),h=s.ammo.speed*Math.sin((t-90)*Math.PI/180),m=this.x+(this.radius+s.ammo.size+1)*Math.cos((t-90)*Math.PI/180),r=this.y+(this.radius+s.ammo.size+1)*Math.sin((t-90)*Math.PI/180);e.push(new c(m,r,a,h,i,o))}moveLeft(){this.xSpeed>=-this.speed&&(this.xSpeed=-1*this.speed,this.ySpeed=0)}moveRight(){this.xSpeed<=this.speed&&(this.xSpeed=this.speed,this.ySpeed=0)}moveUp(){this.ySpeed>=-this.speed&&(this.ySpeed=-1*this.speed,this.xSpeed=0)}moveDown(){this.ySpeed<=this.speed&&(this.ySpeed=this.speed,this.xSpeed=0)}}class w extends p{constructor(){super(void 0,void 0,100,void 0,0,0,"planet")}}const S=new class{constructor(){this.level=0,this.score=0,this.items=[],this.ship=new g(200,800),this.spawner=new w,this.balls=[],this.ammos=[],this.spammos=[],this.explosive=[]}itemState(){for(const e of this.items)e.toBall(this.items),e.toObj(this.spawner),e.toEdge(),e.toObj(this.ship)&&("item4"===e.imgId&&(this.score+=s.items.item4.score),e.doFunc(this.ship),e.remove(this.items)),e.makeAMove(),n(e)}specialAmmoState(){for(const e of this.spammos){if(e.toObj(this.ship)&&"ammo1"===e.imgId&&(this.ship.health-=e.damage),"ammo3"===e.imgId){for(const e of this.balls)e.makeExplosive(this.explosive);for(const e of this.ammos)this.explosive.push(new u(e.x,e.y,e.radius/2,"explosive5",.3));this.balls=[],this.ammos=[],this.spammos=this.spammos.filter((t=>t!==e))}"ammo2"===e.imgId&&(e.toEdge(),e.toObj(this.spawner),e.toObj(this.ship)&&(this.ship.health+=3)),e.makeAMove(),n(e)}}ammoState(){for(const e of this.ammos){if(e.toEdge(),e.toObj(this.spawner),e.toObj(this.ship)&&(this.ship.health-=e.damage),e.toArrOfObj(this.balls)>=0){const t=this.balls[e.toArrOfObj(this.balls)];m(s.ammo.destroyAsteroidRate)?t.canExploreToSmaller()?(t.explore(this.balls),t.makeExplosive(this.explosive),e.remove(this.ammos),this.score+=5,this.spawnItemFrom(t,s.game.itemDropMultiplierWhenExploreToChild)):this.spawnItemFrom(t):e.toBall(this.balls)}e.makeAMove()}}ballState(){for(const e of this.balls)e.toEdge(),e.toObj(this.spawner),e.toObj(this.ship)&&(e.explore(this.balls),this.ship.health-=e.damage,this.score-=10,e.makeExplosive(this.explosive)),e.toArrOfObj(this.ammos)>=0&&(m(s.ammo.destroyAsteroidRate)?(this.ammos[e.toArrOfObj(this.ammos)].remove(this.ammos),e.makeExplosive(this.explosive),e.canExploreToSmaller()?(e.explore(this.balls),this.score+=5,this.spawnItemFrom(e,s.game.itemDropMultiplierWhenExploreToChild)):this.spawnItemFrom(e)):e.toBall(this.ammos)),e.toArrOfObj(this.spammos)>=0&&(m(s.ammo.destroyAsteroidRate)?e.remove(this.balls):e.canExploreToSmaller()?e.explore(this.balls):e.remove(this.balls),this.spawnItemFrom(e,s.game.itemDropMultiplierUseSpecialAmmo),e.makeExplosive(this.explosive),this.score+=5),e.toBall(this.balls),e.makeAMove()}spawnItemFrom(e,t=1){e.remove(this.balls),e.makeExplosive(this.explosive,.3),this.score+=5,m(s.items.item0.rate*t)&&(this.items.push(new x(e.x,e.y,"item0")),!s.game.multiDrop)||m(s.items.item1.rate*t)&&(this.items.push(new x(e.x,e.y,"item1")),!s.game.multiDrop)||m(s.items.item2.rate*t)&&(this.items.push(new x(e.x,e.y,"item2")),!s.game.multiDrop)||m(s.items.item3.rate*t)&&(this.items.push(new x(e.x,e.y,"item3")),!s.game.multiDrop)||m(s.items.item4.rate*t)&&this.items.push(new x(e.x,e.y,"item4"))}drawBall(){for(const e of this.balls)n(e)}drawAmmo(){for(const e of this.ammos)n(e,!0)}shipState(){if(this.ship.health<=0){const e=Number(localStorage.getItem("highScore")||"0"),t=Number(localStorage.getItem("highLevel")||"0");e<this.score&&localStorage.setItem("highScore",this.score),t<this.level&&localStorage.setItem("highLevel",this.level),l(),d(),setTimeout((async()=>{await async function(e,t){return window.Neu?"YES"===await window.Neu.os.showMessageBox("You lose",t,"YES_NO"):confirm(t)}(0,"Play again?")?window.location.reload():window.location.href="index.html"}),1e3)}this.ship.toObj(this.spawner),this.ship.toEdge(),this.ship.makeAMove()}displayScore(e,i){t.font="25px Verdana",t.fillStyle="white",t.fillText("Stage   "+S.level,e,i-30),t.fillText("Health  "+Math.floor(this.ship.health),e,i),t.fillText("Items   "+this.ship.totalAmmo.length,e,i+30),t.fillText("Score   "+this.score,e,i+110);const o=this.ship.totalAmmo.length?this.ship.totalAmmo[this.ship.totalAmmo.length-1].imgId:"",a=s.items.ammos[o]||"None";t.fillText("Ammo  "+a,e,i+60)}drawExplosion(){for(const e of this.explosive)e.drawExplosive(this.explosive)}combineState(){this.specialAmmoState(),this.ammoState(),this.ballState(),this.shipState(),this.itemState()}};let f=[];!function(e){let t="";for(let e=0;e<8;e++)t+='<img alt="rock" src="img/rock/rock'+e+'.png" id="rock'+e+'" style="display: none">';o.innerHTML+=t}(),function(e){let t="";for(let e=0;e<4;e++)t+='<img alt="ammo" src="img/ammo/ammo'+e+'.png" id="ammo'+e+'" style="display: none">';o.innerHTML+=t}(),function(e){let t="";for(let e=0;e<5;e++)t+='<img alt="object" src="img/item/item'+e+'.png" id="item'+e+'" style="display: none">';o.innerHTML+=t}(),function(e){let t="";for(let e=0;e<6;e++)t+='<img alt="explosive" src="img/explosive/explosive'+e+'.png" id="explosive'+e+'" style="display: none">';o.innerHTML+=t}(),window.Neu&&window.Neu.events.on("windowClose",(()=>{f.forEach(clearTimeout),window.Neu.app.exit()})),function e(){S.score+=S.level*s.game.survivalLevelBonus+Math.floor((S.balls.length+S.ammos.length)*s.game.survivalAsteroidBonus),f.push(setTimeout(e,s.game.timePerSurvivalScore))}(),function e(){l(),d(),S.combineState(),S.drawExplosion(),S.drawAmmo(),S.drawBall(),n(S.spawner,!0),n(S.ship,!0),S.displayScore(15,60),S.ship.health>0?f.push(setTimeout(e,20)):n(S.ship,!1,"explosive1")}(),function e(){S.level++,f.push(setTimeout(e,s.game.timePerLevel))}(),function e(){S.spawner.spawn(S.balls,S.level),S.spawner.color=a(Math.random()),f.push(setTimeout(e,s.game.timePerSpawn))}(),window.addEventListener("keydown",(e=>{switch(e.key){case"ArrowRight":S.ship.moveRight();break;case"ArrowLeft":S.ship.moveLeft();break;case"ArrowUp":S.ship.moveUp();break;case"ArrowDown":S.ship.moveDown();break;case"a":if(S.ship.totalAmmo.length>0){const e=S.ship.totalAmmo.pop();S.ship.shoot(S.spammos,S.ship.angle,e.imgId,10)}break;case"s":S.ship.shoot(S.ammos,S.ship.angle,"ammo0")}}))})();