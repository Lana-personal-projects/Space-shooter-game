(()=>{"use strict";const s=document.getElementById("screen"),t=s.getContext("2d"),i=document.getElementById("background");s.width=window.innerWidth-10,s.height=window.innerHeight-10;try{Neutralino.init()}catch(s){console.log("Not running in desktop")}function e(s){let t,i,e,h=~~(6*s),o=6*s-h,a=1-o;switch(h%6){case 0:t=1,i=o,e=0;break;case 1:t=a,i=1,e=0;break;case 2:t=0,i=1,e=o;break;case 3:t=0,i=a,e=1;break;case 4:t=o,i=0,e=1;break;case 5:t=1,i=0,e=a}return"#"+("00"+(~~(255*t)).toString(16)).slice(-2)+("00"+(~~(255*i)).toString(16)).slice(-2)+("00"+(~~(255*e)).toString(16)).slice(-2)}function h(s,t=0){return s-=t,Math.round(Math.random()*s+t)}function o(s,t){return Math.sqrt(Math.abs(s)*Math.abs(s)+Math.abs(t)*Math.abs(t))}function a(){t.clearRect(0,0,s.width,s.height)}function r(s,i=!1,e=s.imgId){const h=document.getElementById(e);t.beginPath(),t.save(),i&&(t.shadowOffX=10,t.shadowOffY=10,t.shadowBlur=20,t.shadowColor=s.color),t.translate(s.x,s.y),t.rotate(s.angle*Math.PI/180),t.drawImage(h,-s.radius-1,-s.radius-1,2*s.radius+2,2*s.radius+2),t.restore()}function n(){t.beginPath(),t.drawImage(i,0,0,s.width,s.height)}class l{constructor(t,i,o,a,r,n,l){this.imgId=l||function(s){let t="rock";return t+=h(7,0)+"",t}(),this.isSpin=!0,this.isExist=!0,this.x=t||s.width/2,this.y=i||s.height/2,this.color=a||e(Math.random()),this.radius=o||h(60,60),this.xSpeed=r||h(5,0),this.ySpeed=n||h(5,0),this.angle=0,this.damage=this.radius/4}increaseAngle(s){this.isSpin&&(this.angle=this.angle+s,this.angle>=360&&(this.angle=0))}makeAMove(){this.x+=this.xSpeed,this.y+=this.ySpeed,this.increaseAngle(o(this.xSpeed,this.ySpeed)/3)}relocate(s,t,i){const e=this.radius+i,h=o(this.x-s,this.y-t);e>h&&(this.x=(this.x-s)*(e/h)+s,this.y=(this.y-t)*(e/h)+t)}toEdge(){this.x<=this.radius?(this.x=this.radius,this.xSpeed*=-1):this.x>=s.width-this.radius?(this.x=s.width-this.radius,this.xSpeed*=-1):this.y<=this.radius?(this.y=this.radius,this.ySpeed*=-1):this.y>=s.height-this.radius&&(this.y=s.height-this.radius,this.ySpeed*=-1)}toBall(s){for(const t of s){const s=t.radius+this.radius,i=o(t.x-this.x,t.y-this.y);if(0!==i&&(s>i&&this.relocate(t.x,t.y,t.radius),s>=i)){const i=((this.radius-t.radius)*this.xSpeed+2*t.radius*t.xSpeed)/s,e=((this.radius-t.radius)*this.ySpeed+2*t.radius*t.ySpeed)/s,h=((t.radius-this.radius)*t.xSpeed+2*this.radius*this.xSpeed)/s,o=((t.radius-this.radius)*t.ySpeed+2*this.radius*this.ySpeed)/s;this.xSpeed=i,this.ySpeed=e,t.xSpeed=h,t.ySpeed=o}}}toObj(s){const t=this.radius+s.radius,i=o(this.x-s.x,this.y-s.y);if(0!==i&&(i<t&&this.relocate(s.x,s.y,s.radius),i<=t))return this.xSpeed*=-1,this.ySpeed*=-1,!0}toArrOfObj(s){for(let t=0;t<s.length;t++)if(s[t].radius+this.radius>=o(s[t].x-this.x,s[t].y-this.y))return t;return-1}remove(s){this.isExist=!1;for(let t=0;t<s.length;t++)s[t].isExist||s.splice(t,1)}explore(s,t=1){if(this.remove(s),this.radius/2>10)for(let i=0;i<t;i++)s.push(new l(this.x,this.y,this.radius/1.5,this.color,void 0,void 0,this.imgId))}spawn(s,t=1){for(let i=0;i<t;i++)s.push(new l(this.x,this.y,void 0,this.color))}makeExplosive(s,t){h(1,0)?(s.push(new m(this.x,this.y,2*this.radius,"explosive0",t)),s.push(new m(this.x,this.y,1.2*this.radius,void 0,t))):h(1,0)?s.push(new m(this.x,this.y,2*this.radius,void 0,t)):(s.push(new m(this.x,this.y,3.5*this.radius,"explosive4",t)),s.push(new m(this.x,this.y,1*this.radius,void 0,t)))}}class m extends l{constructor(s,t,i,e,o){super(s,t,i,"yellow",.2,.2),this.imgId=e||function(s){let t="explosive";return t+=h(4,0)+"",t}(),this.count=50*o||50}drawExplosive(s){this.count>0?(r(this,!1),this.count-=1):this.remove(s)}}class d extends l{constructor(s,t,i,e,h,o=25){super(s,t,o,"green",i,e),this.imgId=h||"ammo0",this.damage=10}}class p extends l{constructor(s,t,i,e=25){super(s,t,e,"blue",.5,.5),this.imgId=i||"item0"}doFunc(s){switch(this.imgId){case"item0":for(let t=0;t<3;t++)s.totalAmmo.push(new d(s.x,s.y,1,1,"ammo1",30));break;case"item1":s.health+=20;break;case"item2":s.totalAmmo.push(new d(s.x,s.y,1,1,"ammo2",30));break;case"item3":s.totalAmmo.push(new d(s.x,s.y,1,1,"ammo3",30))}}}class c extends l{constructor(s,t,i,e,h,o){super(s,t,20,h,.2,.2),this.imgId=o||"ship",this.speed=i||5,this.health=e||100,this.totalAmmo=[]}shoot(s,t=this.angle,i,e){let h=10*Math.cos((t-90)*Math.PI/180),o=10*Math.sin((t-90)*Math.PI/180);s.push(new d(this.x,this.y,h,o,i,e)),this.health+=20}moveLeft(){this.xSpeed>=0&&(this.xSpeed=-1*this.speed,this.ySpeed=0)}moveRight(){this.xSpeed<=0&&(this.xSpeed=this.speed,this.ySpeed=0)}moveUp(){this.ySpeed>=0&&(this.ySpeed=-1*this.speed,this.xSpeed=0)}moveDown(){this.ySpeed<=0&&(this.ySpeed=this.speed,this.xSpeed=0)}}const u=new class{constructor(){this.score=0,this.items=[],this.ship=new c(200,800,5,100,"white"),this.spawner=new l(void 0,void 0,100,void 0,0,0,"planet"),this.balls=[],this.ammos=[],this.spammos=[],this.explosive=[]}itemState(){for(const s of this.items)s.toBall(this.items),s.toObj(this.spawner),s.toEdge(),s.toObj(this.ship)&&("item4"===s.imgId&&(this.score+=30),s.doFunc(this.ship),s.remove(this.items)),s.makeAMove(),r(s)}specialAmmoState(){for(const s of this.spammos){if(s.toObj(this.ship)&&"ammo1"===s.imgId&&(this.ship.health-=s.damage),"ammo3"===s.imgId){for(const s of this.balls)s.makeExplosive(this.explosive);for(const s of this.ammos)this.explosive.push(new m(s.x,s.y,s.radius/2,"explosive5",.3));this.balls=[],this.ammos=[],this.spammos=[]}"ammo2"===s.imgId&&(s.toEdge(),s.toObj(this.spawner),s.toObj(this.ship)&&(this.ship.health+=3)),s.makeAMove(),r(s)}}ammoState(){for(const s of this.ammos){if(s.toEdge(),s.toObj(this.spawner),s.toObj(this.ship)&&(this.ship.health-=s.damage),s.toArrOfObj(this.balls)>=0){const t=this.balls[s.toArrOfObj(this.balls)];h(1,0)?t.radius/2>10?(t.explore(this.balls,2),t.makeExplosive(this.explosive),s.remove(this.ammos),this.score+=5):this.spawnItemFrom(t):s.toBall(this.balls)}s.makeAMove()}}ballState(){for(const s of this.balls)s.toEdge(),s.toObj(this.spawner),s.toObj(this.ship)&&(s.explore(this.balls,2),this.ship.health-=s.damage,this.score-=10,s.makeExplosive(this.explosive)),s.toArrOfObj(this.ammos)>=0&&(h(1,0)?(this.ammos[s.toArrOfObj(this.ammos)].remove(this.ammos),s.makeExplosive(this.explosive),s.radius/2>10?(s.explore(this.balls,2),this.score+=5):this.spawnItemFrom(s)):s.toBall(this.ammos)),s.toArrOfObj(this.spammos)>=0&&(h(1,0)?s.remove(this.balls):s.radius/2>15?s.explore(this.balls,2):s.remove(this.balls),s.makeExplosive(this.explosive),this.score+=5),s.toBall(this.balls),s.makeAMove()}spawnItemFrom(s){h(4,0)||this.items.push(new p(s.x,s.y)),h(5,0)||this.items.push(new p(s.x,s.y,"item1")),h(20,0)||this.items.push(new p(s.x,s.y,"item2")),h(25,0)||this.items.push(new p(s.x,s.y,"item3")),h(3,0)||this.items.push(new p(s.x,s.y,"item4")),s.remove(this.balls),s.makeExplosive(this.explosive,.3),this.score+=5}drawBall(){for(const s of this.balls)r(s)}drawAmmo(){for(const s of this.ammos)r(s,!0)}shipState(){this.ship.health<=0&&(a(),n(),setTimeout((async()=>{await async function(s,t){try{return"YES"===await window.Neutralino.os.showMessageBox("You lose",t,"YES_NO")}catch(s){return confirm(t)}}(0,"Play again?")&&window.location.reload()}),1e3)),this.ship.toObj(this.spawner),this.ship.toEdge(),this.ship.makeAMove()}displayScore(s,i,e=""){t.font="25px Verdana",t.fillStyle="white",t.fillText(e,s,i-30),t.fillText("Health "+Math.floor(this.ship.health),s,i),t.fillText("Items: "+this.ship.totalAmmo.length,s,i+30),t.fillText("Score "+this.score,s,i+80)}drawExplosion(){for(const s of this.explosive)s.drawExplosive(this.explosive)}combineState(){this.specialAmmoState(),this.ammoState(),this.ballState(),this.shipState(),this.itemState()}};let x=0;!function(s){let t="";for(let s=0;s<8;s++)t+='<img alt="rock" src="img/rock/rock'+s+'.png" id="rock'+s+'" style="display: none">';document.getElementById("img-dir").innerHTML+=t}(),function(s){let t="";for(let s=0;s<4;s++)t+='<img alt="ammo" src="img/ammo/ammo'+s+'.png" id="ammo'+s+'" style="display: none">';document.getElementById("img-dir").innerHTML+=t}(),function(s){let t="";for(let s=0;s<5;s++)t+='<img alt="object" src="img/item/item'+s+'.png" id="item'+s+'" style="display: none">';document.getElementById("img-dir").innerHTML+=t}(),function(s){let t="";for(let s=0;s<6;s++)t+='<img alt="explosive" src="img/explosive/explosive'+s+'.png" id="explosive'+s+'" style="display: none">';document.getElementById("img-dir").innerHTML+=t}(),function s(){u.score+=x+Math.floor((u.balls.length+u.ammos.length)/10),setTimeout(s,5e3)}(),function s(){a(),n(),u.combineState(),u.drawExplosion(),u.drawAmmo(),u.drawBall(),r(u.spawner,!0),r(u.ship,!0),u.displayScore(15,60,"stage: "+x),u.ship.health>0?setTimeout(s,20):r(u.ship,!1,"explosive1")}(),function s(){x++,setTimeout(s,9e4)}(),function s(){u.spawner.spawn(u.balls,x),u.spawner.color=e(Math.random()),setTimeout(s,15e3)}(),window.addEventListener("keydown",(s=>{switch(s.key){case"ArrowRight":u.ship.moveRight();break;case"ArrowLeft":u.ship.moveLeft();break;case"ArrowUp":u.ship.moveUp();break;case"ArrowDown":u.ship.moveDown();break;case"a":if(u.ship.totalAmmo.length>0){const s=u.ship.totalAmmo.pop();u.ship.shoot(u.spammos,u.ship,s.imgId,10)}break;case"s":u.ship.shoot(u.ammos,u.ship.angle,"ammo0")}}))})();