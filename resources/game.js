(()=>{"use strict";const e=document.getElementById("screen"),t=e.getContext("2d"),s=window.gameConfig||{game:{timePerSpawn:15e3,timePerLevel:6e4,timePerSurvivalScore:5e3,survivalAsteroidBonus:.2,survivalLevelBonus:1,itemDropMultiplierWhenExploreToChild:.2,itemDropMultiplierUseSpecialAmmo:.05,multiDrop:!1,tick:20},asteroid:{spin:.3,damagePerRadius:.25,childrenSizeRatio:.65,minimalSizeCanSplit:30,minNumberOfChild:1,maxNumberOfChild:3,minSize:60,maxSize:100,minSpeed:0,maxSpeed:5},ship:{health:100,speed:5,spin:.3,size:20},ammo:{damage:10,destroyAsteroidRate:.6,speed:10,size:25},items:{ammos:{ammo1:"Blue",ammo2:"Red",ammo3:"Bomb"},item0:{name:"Blue Ammo",amount:3,rate:.12},item1:{name:"Burger",heal:15,rate:.2},item2:{name:"Red Ammo",amount:1,rate:.015},item3:{name:"Antimatter Bomb",amount:1,rate:.01},item4:{name:"Gold",rate:.3,score:30}}},i=document.getElementById("background"),o=document.getElementById("img-dir");function h(e){let t,s,i,o=~~(6*e),h=6*e-o,a=1-h;switch(o%6){case 0:t=1,s=h,i=0;break;case 1:t=a,s=1,i=0;break;case 2:t=0,s=1,i=h;break;case 3:t=0,s=a,i=1;break;case 4:t=h,s=0,i=1;break;case 5:t=1,s=0,i=a}return"#"+("00"+(~~(255*t)).toString(16)).slice(-2)+("00"+(~~(255*s)).toString(16)).slice(-2)+("00"+(~~(255*i)).toString(16)).slice(-2)}function a(e,t=0){return e===t?e:(e-=t,Math.round(Math.random()*e+t))}function m(e){return Math.random()<=e}function r(e,t){return Math.sqrt(Math.abs(e)*Math.abs(e)+Math.abs(t)*Math.abs(t))}function l(e,s=!1,i=e.imgId){const o=document.getElementById(i);t.beginPath(),t.save(),s&&(t.shadowOffX=10,t.shadowOffY=10,t.shadowBlur=20,t.shadowColor=e.color),t.translate(e.x,e.y),t.rotate(e.angle*Math.PI/180),t.drawImage(o,-e.radius-1,-e.radius-1,2*e.radius+2,2*e.radius+2),t.restore()}e.width=window.innerWidth-10,e.height=window.innerHeight-10;class n{constructor(t,i,o,m,r,l,n,d){this.imgId=n||function(e){let t="rock";return t+=a(7,0)+"",t}(),this.spinSpeed=0===d?0:d||s.asteroid.spin,this.isExist=!0,this.x=t||e.width/2,this.y=i||e.height/2,this.color=m||h(Math.random()),this.radius=o||a(s.asteroid.maxSize,s.asteroid.minSize),this.xSpeed=r||a(s.asteroid.maxSpeed,s.asteroid.minSpeed),this.ySpeed=l||a(s.asteroid.maxSpeed,s.asteroid.minSpeed),this.angle=0,this.damage=this.radius*s.asteroid.damagePerRadius}increaseAngle(e){this.angle=this.angle+e,this.angle>=360&&(this.angle=0)}makeAMove(){this.x+=this.xSpeed,this.y+=this.ySpeed,this.spinSpeed&&this.increaseAngle(r(this.xSpeed,this.ySpeed)*this.spinSpeed)}relocate(e,t,s){const i=this.radius+s,o=r(this.x-e,this.y-t);i>o&&(this.x=(this.x-e)*(i/o)+e,this.y=(this.y-t)*(i/o)+t)}toEdge(){this.x<=this.radius?(this.x=this.radius,this.xSpeed*=-1):this.x>=e.width-this.radius?(this.x=e.width-this.radius,this.xSpeed*=-1):this.y<=this.radius?(this.y=this.radius,this.ySpeed*=-1):this.y>=e.height-this.radius&&(this.y=e.height-this.radius,this.ySpeed*=-1)}toBall(e){for(const t of e){const e=t.radius+this.radius,s=r(t.x-this.x,t.y-this.y);if(0!==s&&(e>s&&this.relocate(t.x,t.y,t.radius),e>=s)){const s=((this.radius-t.radius)*this.xSpeed+2*t.radius*t.xSpeed)/e,i=((this.radius-t.radius)*this.ySpeed+2*t.radius*t.ySpeed)/e,o=((t.radius-this.radius)*t.xSpeed+2*this.radius*this.xSpeed)/e,h=((t.radius-this.radius)*t.ySpeed+2*this.radius*this.ySpeed)/e;this.xSpeed=s,this.ySpeed=i,t.xSpeed=o,t.ySpeed=h}}}toObj(e){const t=this.radius+e.radius,s=r(this.x-e.x,this.y-e.y);if(0!==s&&(s<t&&this.relocate(e.x,e.y,e.radius),s<=t))return this.xSpeed*=-1,this.ySpeed*=-1,!0}toArrOfObj(e){for(let t=0;t<e.length;t++)if(e[t].radius+this.radius>=r(e[t].x-this.x,e[t].y-this.y))return t;return-1}remove(e){this.isExist=!1;for(let t=0;t<e.length;t++)e[t].isExist||e.splice(t,1)}explore(e){this.remove(e);const t=a(s.asteroid.maxNumberOfChild,s.asteroid.minNumberOfChild);if(t&&this.canExploreToSmaller())for(let i=0;i<t;i++)e.push(new n(this.x,this.y,this.radius*s.asteroid.childrenSizeRatio,this.color,void 0,void 0,this.imgId))}canExploreToSmaller(){return this.radius>s.asteroid.minimalSizeCanSplit}spawn(e,t=1){for(let s=0;s<t;s++)e.push(new n(this.x,this.y,void 0,this.color))}makeExplosive(e,t){a(1,0)?(e.push(new d(this.x,this.y,2*this.radius,"explosive0",t)),e.push(new d(this.x,this.y,1.2*this.radius,void 0,t))):a(1,0)?e.push(new d(this.x,this.y,2*this.radius,void 0,t)):(e.push(new d(this.x,this.y,3.5*this.radius,"explosive4",t)),e.push(new d(this.x,this.y,1*this.radius,void 0,t)))}}class d extends n{constructor(e,t,s,i,o){super(e,t,s,"yellow",.2,.2),this.imgId=i||function(e){let t="explosive";return t+=a(4,0)+"",t}(),this.count=50*o||50}drawExplosive(e){this.count>0?(l(this,!1),this.count-=1):this.remove(e)}}class p extends n{constructor(e,t,i,o,h,a){super(e,t,a||s.ammo.size,"green",i,o),this.imgId=h||"ammo0",this.damage=s.ammo.damage}}class u extends n{constructor(e,t,s,i=25){super(e,t,i,"blue",.5,.5),this.imgId=s||"item0"}doFunc(e){switch(this.imgId){case"item0":for(let t=0;t<s.items.item0.amount;t++)e.totalAmmo.push(new p(e.x,e.y,1,1,"ammo1",30));break;case"item1":e.health+=s.items.item1.heal;break;case"item2":for(let t=0;t<s.items.item2.amount;t++)e.totalAmmo.push(new p(e.x,e.y,1,1,"ammo2",30));break;case"item3":for(let t=0;t<s.items.item3.amount;t++)e.totalAmmo.push(new p(e.x,e.y,1,1,"ammo3",30))}}}class c extends n{constructor(e,t,i,o,h,a){super(e,t,s.ship.size,h,.2,.2),this.color=h||"white",this.imgId=a||"ship",this.speed=i||s.ship.speed,this.health=o||s.ship.health,this.spinSpeed=s.ship.spin,this.totalAmmo=[]}shoot(e,t=this.angle,i,o){const h=s.ammo.speed*Math.cos((t-90)*Math.PI/180),a=s.ammo.speed*Math.sin((t-90)*Math.PI/180),m=this.x+(this.radius+s.ammo.size+1)*Math.cos((t-90)*Math.PI/180),r=this.y+(this.radius+s.ammo.size+1)*Math.sin((t-90)*Math.PI/180);e.push(new p(m,r,h,a,i,o))}moveLeft(){this.xSpeed>=-this.speed&&(this.xSpeed=-1*this.speed,this.ySpeed=0)}moveRight(){this.xSpeed<=this.speed&&(this.xSpeed=this.speed,this.ySpeed=0)}moveUp(){this.ySpeed>=-this.speed&&(this.ySpeed=-1*this.speed,this.xSpeed=0)}moveDown(){this.ySpeed<=this.speed&&(this.ySpeed=this.speed,this.xSpeed=0)}}class g extends n{constructor(){super(void 0,void 0,100,void 0,0,0,"center")}}window.game=new class{constructor(){this.loops=[],this.level=0,this.score=0,this.items=[],this.ship=new c(200,800),this.spawner=new g,this.balls=[],this.ammos=[],this.spammos=[],this.explosive=[]}itemState(){for(const e of this.items)e.toBall(this.items),e.toObj(this.spawner),e.toEdge(),e.toObj(this.ship)&&("item4"===e.imgId&&(this.score+=s.items.item4.score),e.doFunc(this.ship),e.remove(this.items)),e.makeAMove()}specialAmmoState(){for(const e of this.spammos){if(e.toObj(this.ship)&&"ammo1"===e.imgId&&(this.ship.health-=e.damage),"ammo3"===e.imgId){for(const e of this.balls)e.makeExplosive(this.explosive);for(const e of this.ammos)this.explosive.push(new d(e.x,e.y,e.radius/2,"explosive5",.3));this.balls=[],this.ammos=[],this.spammos=this.spammos.filter((t=>t!==e))}"ammo2"===e.imgId&&(e.toEdge(),e.toObj(this.spawner),e.toObj(this.ship)&&(this.ship.health+=3)),e.makeAMove()}}ammoState(){for(const e of this.ammos){if(e.toEdge(),e.toObj(this.spawner),e.toObj(this.ship)&&(this.ship.health-=e.damage),e.toArrOfObj(this.balls)>=0){const t=this.balls[e.toArrOfObj(this.balls)];m(s.ammo.destroyAsteroidRate)?t.canExploreToSmaller()?(t.explore(this.balls),t.makeExplosive(this.explosive),e.remove(this.ammos),this.score+=5,this.spawnItemFrom(t,s.game.itemDropMultiplierWhenExploreToChild)):this.spawnItemFrom(t):e.toBall(this.balls)}e.makeAMove()}}ballState(){for(const e of this.balls)e.toEdge(),e.toObj(this.spawner),e.toObj(this.ship)&&(e.explore(this.balls),this.ship.health-=e.damage,this.score-=10,e.makeExplosive(this.explosive)),e.toArrOfObj(this.ammos)>=0&&(m(s.ammo.destroyAsteroidRate)?(this.ammos[e.toArrOfObj(this.ammos)].remove(this.ammos),e.makeExplosive(this.explosive),e.canExploreToSmaller()?(e.explore(this.balls),this.score+=5,this.spawnItemFrom(e,s.game.itemDropMultiplierWhenExploreToChild)):this.spawnItemFrom(e)):e.toBall(this.ammos)),e.toArrOfObj(this.spammos)>=0&&(m(s.ammo.destroyAsteroidRate)?e.remove(this.balls):e.canExploreToSmaller()?e.explore(this.balls):e.remove(this.balls),this.spawnItemFrom(e,s.game.itemDropMultiplierUseSpecialAmmo),e.makeExplosive(this.explosive),this.score+=5),e.toBall(this.balls),e.makeAMove()}spawnItemFrom(e,t=1){e.remove(this.balls),e.makeExplosive(this.explosive,.3),this.score+=5,m(s.items.item0.rate*t)&&(this.items.push(new u(e.x,e.y,"item0")),!s.game.multiDrop)||m(s.items.item1.rate*t)&&(this.items.push(new u(e.x,e.y,"item1")),!s.game.multiDrop)||m(s.items.item2.rate*t)&&(this.items.push(new u(e.x,e.y,"item2")),!s.game.multiDrop)||m(s.items.item3.rate*t)&&(this.items.push(new u(e.x,e.y,"item3")),!s.game.multiDrop)||m(s.items.item4.rate*t)&&this.items.push(new u(e.x,e.y,"item4"))}drawBall(){for(const e of this.balls)l(e)}drawAmmo(){for(const e of this.ammos)l(e,!0)}drawSpecialAmmo(){for(const e of this.spammos)l(e)}drawItem(){for(const e of this.items)l(e)}shipState(){if(this.ship.health<=0){const e=Number(localStorage.getItem("highScore")||"0"),t=Number(localStorage.getItem("highLevel")||"0");e<this.score&&localStorage.setItem("highScore",this.score),t<this.level&&localStorage.setItem("highLevel",this.level),stop(),setTimeout((()=>document.getElementById("overlay").classList.add("visible")),300)}this.ship.toObj(this.spawner),this.ship.toEdge(),this.ship.makeAMove()}displayScore(e,i){t.font="25px Verdana",t.fillStyle="white",t.fillText("Stage   "+game.level,e,i-30),t.fillText("Health  "+Math.floor(this.ship.health),e,i),t.fillText("Items   "+this.ship.totalAmmo.length,e,i+30),t.fillText("Score   "+this.score,e,i+110);const o=this.ship.totalAmmo.length?this.ship.totalAmmo[this.ship.totalAmmo.length-1].imgId:"",h=s.items.ammos[o]||"None";t.fillText("Ammo  "+h,e,i+60)}drawExplosion(){for(const e of this.explosive)e.drawExplosive(this.explosive)}combineState(){this.specialAmmoState(),this.ammoState(),this.ballState(),this.shipState(),this.itemState()}redraw(){t.clearRect(0,0,e.width,e.height),t.beginPath(),t.drawImage(i,0,0,e.width,e.height),this.drawAmmo(),this.drawSpecialAmmo(),this.drawItem(),this.drawBall(),this.drawExplosion(),l(this.spawner,!0),l(this.ship,!0),this.displayScore(15,60)}play(){const e=()=>{this.ship.health>0?(this.combineState(),this.loops.push(setTimeout(e,s.game.tick))):this.shipState()},t=()=>{this.ship.health>0?(this.redraw(),this.main=requestAnimationFrame(t)):l(this.ship,!1,"explosive1")},i=()=>{this.ship.health>0&&(this.level++,this.loops.push(setTimeout(i,s.game.timePerLevel)))},a=()=>{this.ship.health>0&&(this.spawner.spawn(game.balls,game.level),this.spawner.color=h(Math.random()),this.loops.push(setTimeout(a,s.game.timePerSpawn)))},m=()=>{this.ship.health>0&&(this.score+=game.level*s.game.survivalLevelBonus+Math.floor((game.balls.length+game.ammos.length)*s.game.survivalAsteroidBonus),this.loops.push(setTimeout(m,s.game.timePerSurvivalScore)))};!function(e){let t="";for(let e=0;e<8;e++)t+='<img alt="rock" src="img/rock/rock'+e+'.png" id="rock'+e+'" style="display: none">';o.innerHTML+=t}(),function(e){let t="";for(let e=0;e<4;e++)t+='<img alt="ammo" src="img/ammo/ammo'+e+'.png" id="ammo'+e+'" style="display: none">';o.innerHTML+=t}(),function(e){let t="";for(let e=0;e<5;e++)t+='<img alt="object" src="img/item/item'+e+'.png" id="item'+e+'" style="display: none">';o.innerHTML+=t}(),function(e){let t="";for(let e=0;e<6;e++)t+='<img alt="explosive" src="img/explosive/explosive'+e+'.png" id="explosive'+e+'" style="display: none">';o.innerHTML+=t}(),m(),e(),t(),i(),setTimeout(a,2e3),this.keydown=e=>{const t=this;switch(e.key){case"ArrowRight":t.ship.moveRight();break;case"ArrowLeft":t.ship.moveLeft();break;case"ArrowUp":t.ship.moveUp();break;case"ArrowDown":t.ship.moveDown();break;case"a":if(t.ship.totalAmmo.length>0){const e=t.ship.totalAmmo.pop();t.ship.shoot(t.spammos,t.ship.angle,e.imgId,10)}break;case"s":t.ship.shoot(t.ammos,t.ship.angle,"ammo0")}},document.addEventListener("keydown",this.keydown),this.mousedown=e=>{const t=this;if(0===e.button&&(e.preventDefault(),t.ship.shoot(t.ammos,t.ship.angle,"ammo0")),e.button<=2&&(e.preventDefault(),t.ship.totalAmmo.length>0)){const e=t.ship.totalAmmo.pop();t.ship.shoot(t.spammos,t.ship.angle,e.imgId,10)}},document.addEventListener("mousedown",this.mousedown),this.contextmenu=e=>e.preventDefault(),document.addEventListener("contextmenu",this.contextmenu)}stop(){this.loops.forEach(clearTimeout),cancelAnimationFrame(this.main),document.removeEventListener("keydown",this.keydown),document.removeEventListener("mousedown",this.mousedown),document.removeEventListener("contextmenu",this.contextmenu)}},game.play()})();